# data_upload_procedure_from_raw_table_to_2_destination_tables

create or replace PROCEDURE DATA_UPLOAD (P_FILE_PAYROLL VARCHAR2,P_MONTH NUMBER,P_YEAR NUMBER,P_CYCLE NUMBER) AS

CURSOR c_register IS SELECT * FROM 
(SELECT FILE_PAYROLL,MONTH,YEAR,CYCLE,SLNO,FILE_NAME,SHEET_NAME,IDENTIFIER,COLUMN1,COLUMN2,COLUMN3,COLUMN4,COLUMN5,COLUMN6,COLUMN7,COLUMN8,COLUMN9,COLUMN10,COLUMN11,COLUMN12,COLUMN13,COLUMN14,COLUMN15,COLUMN16,COLUMN17,COLUMN18,COLUMN19,COLUMN20,COLUMN21,COLUMN22,COLUMN23,COLUMN24,COLUMN25,COLUMN26,COLUMN27,COLUMN28,COLUMN29,COLUMN30,COLUMN31,COLUMN32,COLUMN33,COLUMN34,COLUMN35,COLUMN36,COLUMN37,COLUMN38,COLUMN39,COLUMN40,COLUMN41,COLUMN42,COLUMN43,COLUMN44,COLUMN45,COLUMN46,COLUMN47,COLUMN48,COLUMN49,COLUMN50,COLUMN51,COLUMN52,COLUMN53,COLUMN54,COLUMN55,COLUMN56,COLUMN57,COLUMN58,COLUMN59,COLUMN60,COLUMN61,COLUMN62,COLUMN63,COLUMN64,COLUMN65,COLUMN66,COLUMN67,COLUMN68,COLUMN69,COLUMN70,COLUMN71,COLUMN72,COLUMN73,COLUMN74,COLUMN75,COLUMN76,COLUMN77,COLUMN78,COLUMN79,COLUMN80,COLUMN81,COLUMN82,COLUMN83,COLUMN84,COLUMN85,COLUMN86,COLUMN87,COLUMN88,COLUMN89,COLUMN90,COLUMN91,COLUMN92,COLUMN93,COLUMN94,COLUMN95,COLUMN96,COLUMN97,COLUMN98,COLUMN99,COLUMN100,COLUMN101,COLUMN102,COLUMN103,COLUMN104,COLUMN105,COLUMN106,COLUMN107,COLUMN108,COLUMN109,COLUMN110,COLUMN111,COLUMN112,COLUMN113,COLUMN114,COLUMN115,COLUMN116,COLUMN117,COLUMN118,COLUMN119,COLUMN120,COLUMN121,COLUMN122,COLUMN123,COLUMN124,COLUMN125,COLUMN126,COLUMN127,COLUMN128,COLUMN129,COLUMN130,COLUMN131,COLUMN132,COLUMN133,COLUMN134,COLUMN135,COLUMN136,COLUMN137,COLUMN138,COLUMN139,COLUMN140,COLUMN141,COLUMN142,COLUMN143,COLUMN144,COLUMN145,COLUMN146,COLUMN147,COLUMN148,COLUMN149,COLUMN150,COLUMN151,COLUMN152,COLUMN153,COLUMN154,COLUMN155,COLUMN156,COLUMN157,COLUMN158,COLUMN159,COLUMN160,COLUMN161,COLUMN162,COLUMN163,COLUMN164,COLUMN165,COLUMN166,COLUMN167,COLUMN168,COLUMN169,COLUMN170,COLUMN171,COLUMN172,COLUMN173,COLUMN174,COLUMN175,COLUMN176,COLUMN177,COLUMN178,COLUMN179,COLUMN180,COLUMN181,COLUMN182,COLUMN183,COLUMN184,COLUMN185,COLUMN186,COLUMN187,COLUMN188,COLUMN189,COLUMN190,COLUMN191,COLUMN192,COLUMN193,COLUMN194,COLUMN195,COLUMN196,COLUMN197,COLUMN198,COLUMN199,COLUMN200,COLUMN201,COLUMN202,COLUMN203,COLUMN204,COLUMN205,COLUMN206,COLUMN207,COLUMN208,COLUMN209,COLUMN210,COLUMN211,COLUMN212,COLUMN213,COLUMN214,COLUMN215,COLUMN216,COLUMN217,COLUMN218,COLUMN219,COLUMN220,COLUMN221,COLUMN222,COLUMN223,COLUMN224,COLUMN225,COLUMN226,COLUMN227,COLUMN228,COLUMN229,COLUMN230,COLUMN231,COLUMN232,COLUMN233,COLUMN234,COLUMN235,COLUMN236,COLUMN237,COLUMN238,COLUMN239,COLUMN240,COLUMN241,COLUMN242,COLUMN243,COLUMN244,COLUMN245,COLUMN246,COLUMN247,COLUMN248,COLUMN249,COLUMN250,COLUMN251,COLUMN252,COLUMN253,COLUMN254,COLUMN255,COLUMN256,COLUMN257,COLUMN258,COLUMN259,COLUMN260,COLUMN261,COLUMN262,COLUMN263,COLUMN264,COLUMN265,COLUMN266,COLUMN267,COLUMN268,COLUMN269,COLUMN270,COLUMN271,COLUMN272,COLUMN273,COLUMN274,COLUMN275,COLUMN276,COLUMN277,COLUMN278,COLUMN279,COLUMN280,COLUMN281,COLUMN282,COLUMN283,COLUMN284,COLUMN285,COLUMN286,COLUMN287,COLUMN288,COLUMN289,COLUMN290,COLUMN291,COLUMN292,COLUMN293,COLUMN294,COLUMN295,COLUMN296,COLUMN297,COLUMN298,COLUMN299,COLUMN300,COLUMN301,COLUMN302,COLUMN303,COLUMN304,COLUMN305,COLUMN306,COLUMN307,COLUMN308,COLUMN309,COLUMN310,COLUMN311,COLUMN312,COLUMN313,COLUMN314,COLUMN315,COLUMN316,COLUMN317,COLUMN318,COLUMN319,COLUMN320,COLUMN321,COLUMN322,COLUMN323,COLUMN324,COLUMN325,COLUMN326,COLUMN327,COLUMN328,COLUMN329,COLUMN330,COLUMN331,COLUMN332,COLUMN333,COLUMN334,COLUMN335,COLUMN336,COLUMN337,COLUMN338,COLUMN339,COLUMN340,COLUMN341,COLUMN342,COLUMN343,COLUMN344,COLUMN345,COLUMN346,COLUMN347,COLUMN348,COLUMN349,COLUMN350,COLUMN351,COLUMN352,COLUMN353,COLUMN354,COLUMN355,COLUMN356,COLUMN357,COLUMN358,COLUMN359,COLUMN360,COLUMN361,COLUMN362,COLUMN363,COLUMN364,COLUMN365,COLUMN366,COLUMN367,COLUMN368,COLUMN369,COLUMN370,COLUMN371,COLUMN372,COLUMN373,COLUMN374,COLUMN375,COLUMN376,COLUMN377,COLUMN378,COLUMN379,COLUMN380,COLUMN381,COLUMN382,COLUMN383,COLUMN384,COLUMN385,COLUMN386,COLUMN387,COLUMN388,COLUMN389,COLUMN390,COLUMN391,COLUMN392,COLUMN393,COLUMN394,COLUMN395,COLUMN396,COLUMN397,COLUMN398,COLUMN399,COLUMN400,COLUMN401,COLUMN402,COLUMN403,COLUMN404,COLUMN405,COLUMN406,COLUMN407,COLUMN408,COLUMN409,COLUMN410,COLUMN411,COLUMN412,COLUMN413,COLUMN414,COLUMN415,COLUMN416,COLUMN417,COLUMN418,COLUMN419,COLUMN420,COLUMN421,COLUMN422,COLUMN423,COLUMN424,COLUMN425,COLUMN426,COLUMN427,COLUMN428,COLUMN429,COLUMN430,COLUMN431,COLUMN432,COLUMN433,COLUMN434,COLUMN435,COLUMN436,COLUMN437,COLUMN438,COLUMN439,COLUMN440,COLUMN441,COLUMN442,COLUMN443,COLUMN444,COLUMN445,COLUMN446,COLUMN447,COLUMN448,COLUMN449,COLUMN450,COLUMN451,COLUMN452,COLUMN453,COLUMN454,COLUMN455,COLUMN456,COLUMN457,COLUMN458,COLUMN459,COLUMN460,COLUMN461,COLUMN462,COLUMN463,COLUMN464,COLUMN465,COLUMN466,COLUMN467,COLUMN468,COLUMN469,COLUMN470,COLUMN471,COLUMN472,COLUMN473,COLUMN474,COLUMN475,COLUMN476,COLUMN477,COLUMN478,COLUMN479,COLUMN480,COLUMN481,COLUMN482,COLUMN483,COLUMN484,COLUMN485,COLUMN486,COLUMN487,COLUMN488,COLUMN489,COLUMN490,COLUMN491,COLUMN492,COLUMN493,COLUMN494,COLUMN495,COLUMN496,COLUMN497,COLUMN498,COLUMN499,COLUMN500,ID,IP_ADDRESS,TIMESTAMP,STATUYN,APPROVED_BY,APPROVED_DT,MAKER_REMARKS,CHECKER_REMARKS
FROM TABLE1 WHERE FILE_PAYROLL = 'SOUTH KOREA-W001'
AND MONTH = P_MONTH
AND YEAR = P_YEAR
AND CYCLE = P_CYCLE
AND SLNO = 0)
UNPIVOT (COL_VAL FOR COL_NAME IN 
(FILE_PAYROLL,MONTH,YEAR,CYCLE,SLNO,FILE_NAME,SHEET_NAME,IDENTIFIER,COLUMN1,COLUMN2,COLUMN3,COLUMN4,COLUMN5,COLUMN6,COLUMN7,COLUMN8,COLUMN9,COLUMN10,COLUMN11,COLUMN12,COLUMN13,COLUMN14,COLUMN15,COLUMN16,COLUMN17,COLUMN18,COLUMN19,COLUMN20,COLUMN21,COLUMN22,COLUMN23,COLUMN24,COLUMN25,COLUMN26,COLUMN27,COLUMN28,COLUMN29,COLUMN30,COLUMN31,COLUMN32,COLUMN33,COLUMN34,COLUMN35,COLUMN36,COLUMN37,COLUMN38,COLUMN39,COLUMN40,COLUMN41,COLUMN42,COLUMN43,COLUMN44,COLUMN45,COLUMN46,COLUMN47,COLUMN48,COLUMN49,COLUMN50,COLUMN51,COLUMN52,COLUMN53,COLUMN54,COLUMN55,COLUMN56,COLUMN57,COLUMN58,COLUMN59,COLUMN60,COLUMN61,COLUMN62,COLUMN63,COLUMN64,COLUMN65,COLUMN66,COLUMN67,COLUMN68,COLUMN69,COLUMN70,COLUMN71,COLUMN72,COLUMN73,COLUMN74,COLUMN75,COLUMN76,COLUMN77,COLUMN78,COLUMN79,COLUMN80,COLUMN81,COLUMN82,COLUMN83,COLUMN84,COLUMN85,COLUMN86,COLUMN87,COLUMN88,COLUMN89,COLUMN90,COLUMN91,COLUMN92,COLUMN93,COLUMN94,COLUMN95,COLUMN96,COLUMN97,COLUMN98,COLUMN99,COLUMN100,COLUMN101,COLUMN102,COLUMN103,COLUMN104,COLUMN105,COLUMN106,COLUMN107,COLUMN108,COLUMN109,COLUMN110,COLUMN111,COLUMN112,COLUMN113,COLUMN114,COLUMN115,COLUMN116,COLUMN117,COLUMN118,COLUMN119,COLUMN120,COLUMN121,COLUMN122,COLUMN123,COLUMN124,COLUMN125,COLUMN126,COLUMN127,COLUMN128,COLUMN129,COLUMN130,COLUMN131,COLUMN132,COLUMN133,COLUMN134,COLUMN135,COLUMN136,COLUMN137,COLUMN138,COLUMN139,COLUMN140,COLUMN141,COLUMN142,COLUMN143,COLUMN144,COLUMN145,COLUMN146,COLUMN147,COLUMN148,COLUMN149,COLUMN150,COLUMN151,COLUMN152,COLUMN153,COLUMN154,COLUMN155,COLUMN156,COLUMN157,COLUMN158,COLUMN159,COLUMN160,COLUMN161,COLUMN162,COLUMN163,COLUMN164,COLUMN165,COLUMN166,COLUMN167,COLUMN168,COLUMN169,COLUMN170,COLUMN171,COLUMN172,COLUMN173,COLUMN174,COLUMN175,COLUMN176,COLUMN177,COLUMN178,COLUMN179,COLUMN180,COLUMN181,COLUMN182,COLUMN183,COLUMN184,COLUMN185,COLUMN186,COLUMN187,COLUMN188,COLUMN189,COLUMN190,COLUMN191,COLUMN192,COLUMN193,COLUMN194,COLUMN195,COLUMN196,COLUMN197,COLUMN198,COLUMN199,COLUMN200,COLUMN201,COLUMN202,COLUMN203,COLUMN204,COLUMN205,COLUMN206,COLUMN207,COLUMN208,COLUMN209,COLUMN210,COLUMN211,COLUMN212,COLUMN213,COLUMN214,COLUMN215,COLUMN216,COLUMN217,COLUMN218,COLUMN219,COLUMN220,COLUMN221,COLUMN222,COLUMN223,COLUMN224,COLUMN225,COLUMN226,COLUMN227,COLUMN228,COLUMN229,COLUMN230,COLUMN231,COLUMN232,COLUMN233,COLUMN234,COLUMN235,COLUMN236,COLUMN237,COLUMN238,COLUMN239,COLUMN240,COLUMN241,COLUMN242,COLUMN243,COLUMN244,COLUMN245,COLUMN246,COLUMN247,COLUMN248,COLUMN249,COLUMN250,COLUMN251,COLUMN252,COLUMN253,COLUMN254,COLUMN255,COLUMN256,COLUMN257,COLUMN258,COLUMN259,COLUMN260,COLUMN261,COLUMN262,COLUMN263,COLUMN264,COLUMN265,COLUMN266,COLUMN267,COLUMN268,COLUMN269,COLUMN270,COLUMN271,COLUMN272,COLUMN273,COLUMN274,COLUMN275,COLUMN276,COLUMN277,COLUMN278,COLUMN279,COLUMN280,COLUMN281,COLUMN282,COLUMN283,COLUMN284,COLUMN285,COLUMN286,COLUMN287,COLUMN288,COLUMN289,COLUMN290,COLUMN291,COLUMN292,COLUMN293,COLUMN294,COLUMN295,COLUMN296,COLUMN297,COLUMN298,COLUMN299,COLUMN300,COLUMN301,COLUMN302,COLUMN303,COLUMN304,COLUMN305,COLUMN306,COLUMN307,COLUMN308,COLUMN309,COLUMN310,COLUMN311,COLUMN312,COLUMN313,COLUMN314,COLUMN315,COLUMN316,COLUMN317,COLUMN318,COLUMN319,COLUMN320,COLUMN321,COLUMN322,COLUMN323,COLUMN324,COLUMN325,COLUMN326,COLUMN327,COLUMN328,COLUMN329,COLUMN330,COLUMN331,COLUMN332,COLUMN333,COLUMN334,COLUMN335,COLUMN336,COLUMN337,COLUMN338,COLUMN339,COLUMN340,COLUMN341,COLUMN342,COLUMN343,COLUMN344,COLUMN345,COLUMN346,COLUMN347,COLUMN348,COLUMN349,COLUMN350,COLUMN351,COLUMN352,COLUMN353,COLUMN354,COLUMN355,COLUMN356,COLUMN357,COLUMN358,COLUMN359,COLUMN360,COLUMN361,COLUMN362,COLUMN363,COLUMN364,COLUMN365,COLUMN366,COLUMN367,COLUMN368,COLUMN369,COLUMN370,COLUMN371,COLUMN372,COLUMN373,COLUMN374,COLUMN375,COLUMN376,COLUMN377,COLUMN378,COLUMN379,COLUMN380,COLUMN381,COLUMN382,COLUMN383,COLUMN384,COLUMN385,COLUMN386,COLUMN387,COLUMN388,COLUMN389,COLUMN390,COLUMN391,COLUMN392,COLUMN393,COLUMN394,COLUMN395,COLUMN396,COLUMN397,COLUMN398,COLUMN399,COLUMN400,COLUMN401,COLUMN402,COLUMN403,COLUMN404,COLUMN405,COLUMN406,COLUMN407,COLUMN408,COLUMN409,COLUMN410,COLUMN411,COLUMN412,COLUMN413,COLUMN414,COLUMN415,COLUMN416,COLUMN417,COLUMN418,COLUMN419,COLUMN420,COLUMN421,COLUMN422,COLUMN423,COLUMN424,COLUMN425,COLUMN426,COLUMN427,COLUMN428,COLUMN429,COLUMN430,COLUMN431,COLUMN432,COLUMN433,COLUMN434,COLUMN435,COLUMN436,COLUMN437,COLUMN438,COLUMN439,COLUMN440,COLUMN441,COLUMN442,COLUMN443,COLUMN444,COLUMN445,COLUMN446,COLUMN447,COLUMN448,COLUMN449,COLUMN450,COLUMN451,COLUMN452,COLUMN453,COLUMN454,COLUMN455,COLUMN456,COLUMN457,COLUMN458,COLUMN459,COLUMN460,COLUMN461,COLUMN462,COLUMN463,COLUMN464,COLUMN465,COLUMN466,COLUMN467,COLUMN468,COLUMN469,COLUMN470,COLUMN471,COLUMN472,COLUMN473,COLUMN474,COLUMN475,COLUMN476,COLUMN477,COLUMN478,COLUMN479,COLUMN480,COLUMN481,COLUMN482,COLUMN483,COLUMN484,COLUMN485,COLUMN486,COLUMN487,COLUMN488,COLUMN489,COLUMN490,COLUMN491,COLUMN492,COLUMN493,COLUMN494,COLUMN495,COLUMN496,COLUMN497,COLUMN498,COLUMN499,COLUMN500,ID,IP_ADDRESS,TIMESTAMP,STATUYN,APPROVED_BY,APPROVED_DT,MAKER_REMARKS,CHECKER_REMARKS));

V1 C1%ROWTYPE;

CURSOR C2 IS SELECT * FROM TABLE2;

V2 C2%ROWTYPE;

CURSOR C3 IS SELECT * FROM TABLE1 
WHERE FILE_PAYROLL = P_PAYROLL_FILE 
AND MONTH = P_MONTH
AND YEAR = P_YEAR
AND CYCLE = P_CYCLE
AND SLNO != 0;

V3 C3%ROWTYPE;


L_COL2 VARCHAR2(100);
L_COL3 VARCHAR2(100);
L_COL12 VARCHAR2(100);
LL_EMPNUM VARCHAR2(100);
LS_EMP_COLUMN_NAME VARCHAR2(100);
L_COL5 VARCHAR2(100);
L_COL8 VARCHAR2(100);
L_COL25 VARCHAR2(100);
L_COL6 VARCHAR2(100);
L_COL4 VARCHAR2(100);
L_SLNO_CNT NUMBER(2);
LL_COL2 VARCHAR2(100);
LL_EMP_NUM NUMBER(8);
LL_INSERT_QRY VARCHAR2(1000);

BEGIN

    OPEN C1;

    LOOP

        FETCH C1 INTO V1;

        EXIT WHEN C1%NOTFOUND;

        BEGIN

            L_COL2 := NULL;
            L_COL3 := NULL;
            L_COL12 := NULL;

            IF V1.COL_VAL IS NOT NULL THEN

                SELECT COL2,COL3,COL12
                INTO L_COL2,L_COL3,L_COL12 FROM TABLE3
                WHERE FILE_PAYROLL = P_FILE_PAYROLL
                AND UPPER(REPLACE(COL2,' ','')) = UPPER(REPLACE(V1.COL_VAL,' ',''));

                --DBMS_OUTPUT.PUT_LINE (L_COL2 || ' ' || L_COL3 || ' ' || L_COL12);

                INSERT INTO TABLE2 VALUES (V1.COL_NAME,L_COL2,L_COL3,L_COL12);

                --DBMS_OUTPUT.PUT_LINE ('insert successfully completed');

        END IF;

        EXCEPTION

            WHEN OTHERS THEN
             L_COL2 := NULL;
             L_COL3 := NULL;
             L_COL12 := NULL;

        END;

    END LOOP;

    CLOSE C1;


   BEGIN

       LL_EMPNUM := NULL;
       LS_EMP_COLUMN_NAME := NULL;
       L_SLNO_CNT := 0;

       SELECT COL2 INTO LL_EMPNUM FROM TABLE3 
       WHERE FILE_PAYROLL = P_FILE_PAYROLL AND COL13 = 'L_EMP_NUM';

       DBMS_OUTPUT.PUT_LINE (LL_EMPNUM); --EMPNUM

       SELECT COL1 INTO LS_EMP_COLUMN_NAME FROM TABLE2 WHERE COL2 = LL_EMPNUM; -- S_COLUMN9

       DBMS_OUTPUT.PUT_LINE ('column name is : '||LS_EMP_COLUMN_NAME); --S_COLUMN9 

   EXCEPTION

       WHEN OTHERS THEN
       LL_EMPNUM := NULL;
       LS_EMP_COLUMN_NAME := NULL;
       L_SLNO_CNT := 0;
   END;

   OPEN C3;

   LOOP

        FETCH C3 INTO V3;

        EXIT WHEN C3%NOTFOUND;

        L_SLNO_CNT := 0;

        OPEN C2;

        LOOP

            FETCH C2 INTO V2;

            EXIT WHEN C2%NOTFOUND;

            L_SLNO_CNT := L_SLNO_CNT+1;

            BEGIN

                L_COL5 := NULL;
                L_COL8 := NULL;
                L_COL25 := NULL;
                L_COL6 := NULL;
                L_COL4 := NULL;
                LL_COL2 := NULL;


            SELECT COL2,COL5,COL8,COL25,OPF.COL6,OPF.COL4
            INTO LL_COL2,L_COL5,L_COL8,L_COL25,L_COL6,L_COL4
            FROM TABLE4 OPW, TABLE5 OPF
            WHERE OPW.COL1 = P_FILE_PAYROLL
            AND OPF.COL1 = P_FILE_PAYROLL
            AND OPW.COL2 = V2.COL2;

            DBMS_OUTPUT.PUT_LINE (LL_COL2 || ' ' || L_COL5 || ' ' || L_COL8 || ' ' || L_COL25 || ' ' || L_COL6 || ' ' || L_COL4);

            EXCEPTION

            WHEN OTHERS THEN

                L_COL5 := NULL;
                L_COL8 := NULL;
                L_COL25 := NULL;
                L_COL6 := NULL;
                L_COL4 := NULL;
                LL_COL2 := NULL;

            END;

--            INSERT INTO TABLE7 (COL1,COL2,COL3,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21)
--            VALUES('SOUTH KOREA-W001',V_REGISTER1.LL_EMPNUM,L_SLNO_CNT,11,2024,2,L_COL5,L_COL8,L_COL25,NULL,V_REGISTER1.LS_VENDOR_OP_WAGE_TYPE,NULL,NULL,L_COL6,L_COL4,NULL,SYSDATE,NULL,NULL,NULL,NULL);
--            
--            INSERT INTO TABLE6 (COL1,COL2,COL3,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21,COL22,COL23,COL24,COL25,COL26,COL27,COL28,COL29,COL30,COL31,COL32)
--            VALUES('SOUTH KOREA-W001',V_REGISTER1.LL_EMPNUM,L_SLNO_CNT,NULL,NULL,NULL,11,2024,2);



        END LOOP;
    CLOSE C2;  

  END LOOP;
CLOSE C3;  

END;
